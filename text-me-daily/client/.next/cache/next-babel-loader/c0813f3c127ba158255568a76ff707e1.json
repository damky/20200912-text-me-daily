{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/Doug/Library/Mobile Documents/com~apple~CloudDocs/Development/20200912-text-me-daily/text-me-daily/client/pages/dashboard.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { Cookies } from 'react-cookie';\nimport { handleAuth } from '../components/utils/auth';\nimport useSWR from 'swr';\nimport axios from 'axios';\nimport Router from 'next/router'; // set up cookies\n\nexport default function Dashboard(_x, _x2, _x3) {\n  return _Dashboard.apply(this, arguments);\n}\n_c2 = Dashboard;\n\nfunction _Dashboard() {\n  var _s = $RefreshSig$();\n\n  _Dashboard = _asyncToGenerator(_s( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx, server, handleAuth) {\n    var cookies, token, fetcherAuth, _useSWR, data, error;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _s();\n\n            cookies = new Cookies();\n            token = cookies.get('token');\n\n            fetcherAuth = function fetcherAuth(url) {\n              return axios.get(url, {\n                headers: {\n                  'Authorization': token\n                }\n              });\n            };\n\n            _context.t0 = useSWR;\n            _context.t1 = \"\";\n            _context.next = 8;\n            return server;\n\n          case 8:\n            _context.t2 = _context.sent;\n            _context.t3 = _context.t1.concat.call(_context.t1, _context.t2, \"/api/ping\");\n            _context.t4 = fetcherAuth;\n            _useSWR = (0, _context.t0)(_context.t3, _context.t4);\n            data = _useSWR.data;\n            error = _useSWR.error;\n\n            if (!error) {\n              _context.next = 16;\n              break;\n            }\n\n            return _context.abrupt(\"return\", __jsx(\"div\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 17,\n                columnNumber: 12\n              }\n            }, \"error loading. probably not authorized. \", JSON.stringify(error)));\n\n          case 16:\n            if (data) {\n              _context.next = 18;\n              break;\n            }\n\n            return _context.abrupt(\"return\", __jsx(\"div\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 20,\n                columnNumber: 12\n              }\n            }, \"loading...\"));\n\n          case 18:\n            return _context.abrupt(\"return\", handleAuth(token) && __jsx(\"div\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 24,\n                columnNumber: 26\n              }\n            }, __jsx(\"h2\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 24,\n                columnNumber: 31\n              }\n            }, \"secret page\")));\n\n          case 19:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }), \"r2QYs02BSrn+Eu/1uMGZi8N+HnQ=\", false, function () {\n    return [useSWR];\n  }));\n  return _Dashboard.apply(this, arguments);\n}\n\n_c = Dashboard;\nexport function getInitialProps(_x4) {\n  return _getInitialProps.apply(this, arguments);\n}\n\nfunction _getInitialProps() {\n  _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ctx) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", {\n              props: {\n                handleAuth: handleAuth(ctx),\n                server: process.env.SERVER\n              }\n            });\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _getInitialProps.apply(this, arguments);\n}\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Dashboard\");\n$RefreshReg$(_c2, \"Dashboard\");","map":{"version":3,"sources":["/Users/Doug/Library/Mobile Documents/com~apple~CloudDocs/Development/20200912-text-me-daily/text-me-daily/client/pages/dashboard.js"],"names":["Cookies","handleAuth","useSWR","axios","Router","Dashboard","ctx","server","cookies","token","get","fetcherAuth","url","headers","data","error","JSON","stringify","getInitialProps","props","process","env","SERVER"],"mappings":";;;;;AAAA,SAASA,OAAT,QAAwB,cAAxB;AACA,SAASC,UAAT,QAA2B,0BAA3B;AACA,OAAOC,MAAP,MAAmB,KAAnB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,aAAnB,C,CAEA;;AAEA,wBAA8BC,SAA9B;AAAA;AAAA;MAA8BA,S;;;;;2EAAf,iBAAyBC,GAAzB,EAA8BC,MAA9B,EAAsCN,UAAtC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AACPO,YAAAA,OADO,GACG,IAAIR,OAAJ,EADH;AAEPS,YAAAA,KAFO,GAECD,OAAO,CAACE,GAAR,CAAY,OAAZ,CAFD;;AAGPC,YAAAA,WAHO,GAGO,SAAdA,WAAc,CAAAC,GAAG;AAAA,qBAAIT,KAAK,CAACO,GAAN,CAAUE,GAAV,EAAe;AAAEC,gBAAAA,OAAO,EAAE;AAAE,mCAAiBJ;AAAnB;AAAX,eAAf,CAAJ;AAAA,aAHV;;AAAA,0BAIWP,MAJX;AAAA;AAAA;AAAA,mBAI2BK,MAJ3B;;AAAA;AAAA;AAAA;AAAA,0BAI8CI,WAJ9C;AAAA;AAILG,YAAAA,IAJK,WAILA,IAJK;AAICC,YAAAA,KAJD,WAICA,KAJD;;AAAA,iBAMTA,KANS;AAAA;AAAA;AAAA;;AAAA,6CAQJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2DAA8CC,IAAI,CAACC,SAAL,CAAeF,KAAf,CAA9C,CARI;;AAAA;AAAA,gBAURD,IAVQ;AAAA;AAAA;AAAA;;AAAA,6CAWJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAXI;;AAAA;AAAA,6CAeXb,UAAU,CAACQ,KAAD,CAAV,IAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAL,CAfV;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;YAIWP,M;;;;;KAJIG,S;AAmB9B,gBAAsBa,eAAtB;AAAA;AAAA;;;8EAAO,kBAA+BZ,GAA/B;AAAA;AAAA;AAAA;AAAA;AAAA,8CAGE;AACLa,cAAAA,KAAK,EAAE;AACLlB,gBAAAA,UAAU,EAAEA,UAAU,CAACK,GAAD,CADjB;AAELC,gBAAAA,MAAM,EAAEa,OAAO,CAACC,GAAR,CAAYC;AAFf;AADF,aAHF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["import { Cookies } from 'react-cookie';\nimport { handleAuth } from '../components/utils/auth';\nimport useSWR from 'swr';\nimport axios from 'axios';\nimport Router from 'next/router';\n\n// set up cookies\n\nexport default async function Dashboard(ctx, server, handleAuth) {\n  const cookies = new Cookies();\n  const token = cookies.get('token');\n  const fetcherAuth = url => axios.get(url, { headers: { 'Authorization': token } });\n  const { data, error } = useSWR(`${await server}/api/ping`, fetcherAuth);\n\n  if (error) {\n    // Router.push('/');\n    return <div>error loading. probably not authorized. {JSON.stringify(error)}</div>\n  }\n  if (!data) {\n    return <div>loading...</div>\n  }\n\n  return (\n    handleAuth(token) && <div><h2>secret page</h2></div>\n  )\n}\n\nexport async function getInitialProps(ctx) {\n  // must validate jwt\n  // if jwt is invalid we redirect to home\n  return {\n    props: {\n      handleAuth: handleAuth(ctx),\n      server: process.env.SERVER\n    }\n  }\n}"]},"metadata":{},"sourceType":"module"}