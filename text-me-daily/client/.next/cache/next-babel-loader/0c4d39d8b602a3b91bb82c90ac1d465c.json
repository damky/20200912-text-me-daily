{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/Doug/Library/Mobile Documents/com~apple~CloudDocs/Development/20200912-text-me-daily/text-me-daily/client/components/signIn.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport Btn from './btn';\nimport axios from 'axios';\nimport { Cookies } from \"react-cookie\";\nimport useSWR from 'swr';\nimport { useState } from 'react';\nexport function ErrorMsg(_ref) {\n  var children = _ref.children;\n  return __jsx(\"div\", {\n    className: \"errorMsg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 9,\n      columnNumber: 10\n    }\n  }, children);\n}\n_c = ErrorMsg;\nexport function Mongo(_ref2) {\n  _s();\n\n  var serverUrl = _ref2.serverUrl;\n\n  var fetcher = function fetcher(url) {\n    return fetch(\"\", {\n      method: \"POST\",\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify(values)\n    }).then(function (res) {\n      return res.json();\n    });\n  };\n\n  var _useSWR = useSWR(serverUrl + '/api/createuser', fetcher),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  if (error) {\n    console.error(error);\n    return __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 24,\n        columnNumber: 12\n      }\n    }, \"problem\");\n  }\n\n  if (!data) return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 21\n    }\n  }, \"loading...\"); // render data\n\n  return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 10\n    }\n  }, \"added user. \", data);\n}\n\n_s(Mongo, \"r2QYs02BSrn+Eu/1uMGZi8N+HnQ=\", false, function () {\n  return [useSWR];\n});\n\n_c2 = Mongo;\nexport default function SignIn(_ref3) {\n  _s2();\n\n  var _this = this;\n\n  var signin = _ref3.signin,\n      signup = _ref3.signup,\n      serverUrl = _ref3.serverUrl,\n      createUser = _ref3.createUser;\n  var cookies = new Cookies();\n\n  var _useState = useState(''),\n      token = _useState[0],\n      setToken = _useState[1];\n\n  try {\n    fetch(url, {\n      method: \"POST\",\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify(values)\n    });\n  } catch (err) {\n    if (err) console.error(err);\n  }\n\n  var fetcherPost = function fetcherPost(url) {\n    return fetch(url, {\n      method: \"POST\",\n      headers: {\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify(values)\n    }).then(function (res) {\n      return res.data;\n    });\n  };\n\n  var _useSWR2 = useSWR(serverUrl + '/api/createuser', fetcherPost),\n      data = _useSWR2.data,\n      error = _useSWR2.error;\n\n  if (error) console.log('failed to load token' + JSON.stringify(error));\n  if (!data) console.log('loading...');\n  setToken(data.token);\n  cookies.set('token', token);\n  return __jsx(React.Fragment, null, __jsx(Formik, {\n    initialValues: {\n      email: '',\n      password: ''\n    },\n    validate: function validate(values) {\n      var errors = {};\n\n      if (!values.email) {\n        errors.email = 'email required';\n      } else if (!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i.test(values.email)) {\n        errors.email = 'Invalid email address';\n      }\n\n      if (!values.password) {\n        errors.password = 'password required';\n      } else if (signup && !/^(?=.*\\d)(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z])([a-z]|[A-Z]|[0-9]|[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~]){8,}$/.test(values.password)) {\n        errors.password = ['needs to add:'];\n\n        if (!/(?=.*\\d)/.test(values.password)) {\n          errors.password.push('numbers');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'numbers';\n          });\n        }\n\n        if (!/(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])/.test(values.password)) {\n          if (errors.password.findIndex(function (m) {\n            return m === 'special characters';\n          }) === -1) {\n            errors.password.push('special characters');\n          }\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'special characters';\n          });\n        }\n\n        if (!/(?=.*[a-z])/.test(values.password)) {\n          errors.password.push('lowercase');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'lowercase';\n          });\n        }\n\n        if (!/(?=.*[A-Z])/.test(values.password)) {\n          errors.password.push('uppercase');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'uppercase';\n          });\n        }\n\n        if (!/.{8,}/.test(values.password)) {\n          errors.password.push('at least 8');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'at least 8';\n          });\n        }\n\n        errors.password = errors.password.join(',');\n      }\n\n      return errors;\n    },\n    onSubmit: function onSubmit(values, _ref4) {\n      var setSubmitting = _ref4.setSubmitting;\n      signin && setTimeout(function () {\n        setToken();\n        goToUser(serverUrl, values);\n        alert(JSON.stringify(values, null, 2));\n        setSubmitting(false);\n      }, 400);\n      signup && setTimeout(function () {\n        createUser(serverUrl, values);\n        alert(JSON.stringify(values, null, 2));\n        setSubmitting(false);\n      }, 400);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }\n  }, function (_ref5) {\n    var isSubmitting = _ref5.isSubmitting;\n    return __jsx(Form, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 11\n      }\n    }, __jsx(Field, {\n      placeholder: \"email\",\n      className: \"primary\",\n      type: \"email\",\n      name: \"email\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 13\n      }\n    }), __jsx(ErrorMessage, {\n      name: \"email\",\n      render: function render(msg) {\n        return __jsx(ErrorMsg, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 55\n          }\n        }, msg);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 13\n      }\n    }), __jsx(Field, {\n      placeholder: \"password\",\n      className: \"primary\",\n      type: \"password\",\n      name: \"password\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 13\n      }\n    }), __jsx(ErrorMessage, {\n      name: \"password\",\n      render: function render(msg) {\n        return msg.split(',').map(function (m) {\n          return __jsx(ErrorMsg, {\n            key: m,\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 82\n            }\n          }, m);\n        });\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }\n    }), __jsx(Btn, {\n      name: \"submit\",\n      primary: true,\n      submit: true,\n      disabled: isSubmitting,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 13\n      }\n    }, signin && 'sign in' || signup && 'sign up'), __jsx(ErrorMessage, {\n      name: \"submit\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }\n    }));\n  }));\n}\n\n_s2(SignIn, \"rwTBXatEwtUMq2aFIsy78D0pYjU=\", false, function () {\n  return [useSWR];\n});\n\n_c3 = SignIn;\nexport function goToUser(_x, _x2) {\n  return _goToUser.apply(this, arguments);\n}\n\nfunction _goToUser() {\n  var _s3 = $RefreshSig$();\n\n  _goToUser = _asyncToGenerator(_s3( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(serverUrl, values) {\n    var fetcher, cookies, _useSWR3, data, error, theToken;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _s3();\n\n            // set up cookies\n            fetcher = function fetcher(url) {\n              return axios.get(url).then(function (res) {\n                return res.data;\n              });\n            };\n\n            cookies = new Cookies();\n            _useSWR3 = useSWR(serverUrl + '/api/login', fetcher), data = _useSWR3.data, error = _useSWR3.error;\n            if (error) console.log('failed to load token' + JSON.stringify(error));\n            if (!data) console.log('loading...'); // console.log('data token ', data.token);\n\n            theToken = data.token;\n            cookies.set('token', theToken);\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }), \"r2QYs02BSrn+Eu/1uMGZi8N+HnQ=\", false, function () {\n    return [useSWR];\n  }));\n  return _goToUser.apply(this, arguments);\n}\n\nexport function getServerSideProps(_x3) {\n  return _getServerSideProps.apply(this, arguments);\n}\n\nfunction _getServerSideProps() {\n  _getServerSideProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ctx) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", {\n              props: {\n                createUser: createUser(),\n                serverUrl: process.env.SERVER,\n                token: token\n              }\n            });\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _getServerSideProps.apply(this, arguments);\n}\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"ErrorMsg\");\n$RefreshReg$(_c2, \"Mongo\");\n$RefreshReg$(_c3, \"SignIn\");","map":{"version":3,"sources":["/Users/Doug/Library/Mobile Documents/com~apple~CloudDocs/Development/20200912-text-me-daily/text-me-daily/client/components/signIn.js"],"names":["Formik","Form","Field","ErrorMessage","Btn","axios","Cookies","useSWR","useState","ErrorMsg","children","Mongo","serverUrl","fetcher","url","fetch","method","headers","body","JSON","stringify","values","then","res","json","data","error","console","SignIn","signin","signup","createUser","cookies","token","setToken","err","fetcherPost","log","set","email","password","errors","test","push","filter","m","findIndex","join","setSubmitting","setTimeout","goToUser","alert","isSubmitting","msg","split","map","get","theToken","getServerSideProps","ctx","props","process","env","SERVER"],"mappings":"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","sourcesContent":["import { Formik, Form, Field, ErrorMessage } from 'formik'\nimport Btn from './btn';\nimport axios from 'axios';\nimport { Cookies } from \"react-cookie\";\nimport useSWR from 'swr'\nimport { useState } from 'react';\n\nexport function ErrorMsg({ children }) {\n  return <div className=\"errorMsg\">{children}</div>\n}\n\nexport function Mongo({ serverUrl }) {\n  const fetcher = (url) => fetch(``, {\n    method: \"POST\",\n    headers: {\n      'Content-type': 'application/json',\n    },\n    body: JSON.stringify(values)\n  }).then(res => res.json());\n  const { data, error } = useSWR(serverUrl + '/api/createuser', fetcher);\n\n  if (error) {\n    console.error(error);\n    return <div>problem</div>\n  }\n  if (!data) return <div>loading...</div>\n\n  // render data\n  return <div>added user. {data}</div>\n}\n\nexport default function SignIn({ signin, signup, serverUrl, createUser }) {\n  const cookies = new Cookies();\n  const [token, setToken] = useState('');\n  try {\n    fetch(url,\n      {\n        method: \"POST\",\n        headers: {\n          'Content-type': 'application/json',\n        },\n        body: JSON.stringify(values)\n      })\n  } catch (err) {\n    if (err) console.error(err);\n  }\n  const fetcherPost = url => fetch(url,\n    {\n      method: \"POST\",\n      headers: {\n        'Content-type': 'application/json',\n      },\n      body: JSON.stringify(values)\n    }).then(res => res.data);\n  const { data, error } = useSWR(serverUrl + '/api/createuser', fetcherPost);\n  if (error) console.log('failed to load token' + JSON.stringify(error));\n  if (!data) console.log('loading...');\n\n  setToken(data.token);\n  cookies.set('token', token);\n  return (\n    <>\n      <Formik\n        initialValues={{ email: '', password: '' }}\n        validate={values => {\n          const errors = {};\n          if (!values.email) {\n            errors.email = 'email required';\n          } else if (!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i.test(values.email)) {\n            errors.email = 'Invalid email address';\n          }\n          if (!values.password) {\n            errors.password = 'password required'\n          } else if (signup && !/^(?=.*\\d)(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z])([a-z]|[A-Z]|[0-9]|[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~]){8,}$/.test(values.password)) {\n            errors.password = ['needs to add:'];\n            if (!/(?=.*\\d)/.test(values.password)) {\n              errors.password.push('numbers')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'numbers');\n            }\n            if (!/(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])/.test(values.password)) {\n              if (errors.password.findIndex(m => m === 'special characters') === -1) {\n                errors.password.push('special characters');\n              }\n            } else {\n              errors.password = errors.password.filter(m => m !== 'special characters');\n            }\n            if (!/(?=.*[a-z])/.test(values.password)) {\n              errors.password.push('lowercase')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'lowercase');\n            }\n            if (!/(?=.*[A-Z])/.test(values.password)) {\n              errors.password.push('uppercase')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'uppercase');\n            }\n            if (!/.{8,}/.test(values.password)) {\n              errors.password.push('at least 8')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'at least 8');\n            }\n            errors.password = errors.password.join(',')\n          }\n          return errors;\n        }}\n        onSubmit={(values, { setSubmitting }) => {\n          signin &&\n            setTimeout(() => {\n              setToken()\n              goToUser(serverUrl, values);\n              alert(JSON.stringify(values, null, 2));\n              setSubmitting(false);\n            }, 400);\n          signup &&\n            setTimeout(() => {\n              createUser(serverUrl, values);\n              alert(JSON.stringify(values, null, 2));\n              setSubmitting(false);\n            }, 400);\n        }}\n      >\n        {({ isSubmitting }) => (\n          <Form>\n            <Field\n              placeholder=\"email\"\n              className=\"primary\"\n              type=\"email\"\n              name=\"email\"\n            />\n            <ErrorMessage name=\"email\" render={msg => <ErrorMsg>{msg}</ErrorMsg>} />\n            <Field\n              placeholder=\"password\"\n              className=\"primary\"\n              type=\"password\"\n              name=\"password\"\n            />\n            <ErrorMessage name=\"password\" render={msg => msg.split(',').map(m => <ErrorMsg key={m}>{m}</ErrorMsg>)} />\n            <Btn name=\"submit\" primary submit disabled={isSubmitting}>\n              {signin && 'sign in' || signup && 'sign up'}\n            </Btn>\n            <ErrorMessage name=\"submit\" />\n          </Form>\n        )}\n      </Formik>\n    </>\n  )\n}\n\n\nexport async function goToUser(serverUrl, values) {\n  // set up cookies\n  const fetcher = url => axios.get(url).then(res => res.data);\n  const cookies = new Cookies();\n  const { data, error } = useSWR(serverUrl + '/api/login', fetcher);\n  if (error) console.log('failed to load token' + JSON.stringify(error));\n  if (!data) console.log('loading...');\n\n\n  // console.log('data token ', data.token);\n  const theToken = data.token;\n  cookies.set('token', theToken);\n}\n\nexport async function getServerSideProps(ctx) {\n  // set up cookies\n\n\n  return {\n    props: {\n      createUser: createUser(),\n      serverUrl: process.env.SERVER,\n      token: token,\n    }\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}