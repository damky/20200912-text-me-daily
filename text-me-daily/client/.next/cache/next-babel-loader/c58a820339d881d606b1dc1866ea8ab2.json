{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/Doug/Library/Mobile Documents/com~apple~CloudDocs/Development/20200912-text-me-daily/text-me-daily/client/components/signIn.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport Btn from './btn';\nimport axios from 'axios';\nimport { Cookies } from \"react-cookie\";\nimport useSWR from 'swr';\nimport { useState } from 'react';\nimport Router from 'next/router';\nexport function ErrorMsg(_ref) {\n  var children = _ref.children;\n  return __jsx(\"div\", {\n    className: \"errorMsg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 10,\n      columnNumber: 10\n    }\n  }, children);\n}\n_c = ErrorMsg;\nexport default function SignIn(_ref2) {\n  _s();\n\n  var _this = this;\n\n  var signin = _ref2.signin,\n      signup = _ref2.signup,\n      setNeedSignUp = _ref2.setNeedSignUp,\n      setCreatedUser = _ref2.setCreatedUser,\n      serverUrl = _ref2.serverUrl;\n\n  var _useState = useState(false),\n      logInError = _useState[0],\n      setLogInError = _useState[1];\n\n  var createUser = function createUser(values) {\n    try {\n      return fetch(serverUrl + '/api/createuser', {\n        method: \"POST\",\n        headers: {\n          'Content-type': 'application/json'\n        },\n        body: JSON.stringify(values)\n      });\n    } catch (err) {\n      console.error(err);\n      setLogInError(true);\n    }\n  };\n\n  var logInAndSetCookies = function logInAndSetCookies(values) {\n    // set up cookies\n    try {\n      var cookies = new Cookies();\n      axios.post(serverUrl + '/api/login', values).then(function (res) {\n        cookies.set('token', res.data.token);\n        cookies.set('refreshToken', res.data.refreshToken);\n        cookies.set('status', res.data.status);\n      });\n    } catch (err) {\n      console.error(err);\n      setLogInError(true);\n    }\n  };\n\n  return __jsx(React.Fragment, null, __jsx(Formik, {\n    initialValues: {\n      email: 'doug@weomedia.com',\n      password: 'P@ssw0rd'\n    },\n    validate: function validate(values) {\n      var errors = {};\n\n      if (!values.email) {\n        errors.email = 'email required';\n      } else if (!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i.test(values.email)) {\n        errors.email = 'Invalid email address';\n      }\n\n      if (!values.password) {\n        errors.password = 'password required';\n      } else if (signup && !/^(?=.*\\d)(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z])([a-z]|[A-Z]|[0-9]|[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~]){8,}$/.test(values.password)) {\n        errors.password = ['needs to add:'];\n\n        if (!/(?=.*\\d)/.test(values.password)) {\n          errors.password.push('numbers');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'numbers';\n          });\n        }\n\n        if (!/(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])/.test(values.password)) {\n          if (errors.password.findIndex(function (m) {\n            return m === 'special characters';\n          }) === -1) {\n            errors.password.push('special characters');\n          }\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'special characters';\n          });\n        }\n\n        if (!/(?=.*[a-z])/.test(values.password)) {\n          errors.password.push('lowercase');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'lowercase';\n          });\n        }\n\n        if (!/(?=.*[A-Z])/.test(values.password)) {\n          errors.password.push('uppercase');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'uppercase';\n          });\n        }\n\n        if (!/.{8,}/.test(values.password)) {\n          errors.password.push('at least 8');\n        } else {\n          errors.password = errors.password.filter(function (m) {\n            return m !== 'at least 8';\n          });\n        }\n\n        errors.password = errors.password.join(',');\n      }\n\n      return errors;\n    },\n    onSubmit: /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values, _ref3) {\n        var setSubmitting;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                setSubmitting = _ref3.setSubmitting;\n                setLogInError(false);\n                signin && setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.next = 2;\n                          return logInAndSetCookies(values);\n\n                        case 2:\n                          Router.push('/dashboard'); // alert(JSON.stringify(values, null, 2));\n\n                        case 3:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                })), 400);\n                setSubmitting(false);\n                signup && setTimeout(function () {\n                  createUser(values).then(function (res) {\n                    if (res.ok) {\n                      // console.log(res)\n                      // console.log('created');\n                      // alert(JSON.stringify(values, null, 2));\n                      setCreatedUser(true);\n                      setNeedSignUp(false);\n                    } else {\n                      res.json().then(function (res) {\n                        return console.error(res.msg);\n                      });\n                      setLogInError(true);\n                    }\n                  })[\"catch\"](function (err) {\n                    if (err) console.error(err);\n                  });\n                }, 400);\n                setSubmitting(false);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x, _x2) {\n        return _ref4.apply(this, arguments);\n      };\n    }(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 7\n    }\n  }, function (_ref6) {\n    var isSubmitting = _ref6.isSubmitting;\n    return __jsx(Form, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }\n    }, logInError && __jsx(ErrorMsg, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 28\n      }\n    }, \"email/password already exists or is wrong\"), __jsx(Field, {\n      placeholder: \"email\",\n      className: \"primary\",\n      type: \"email\",\n      name: \"email\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 13\n      }\n    }), __jsx(ErrorMessage, {\n      name: \"email\",\n      render: function render(msg) {\n        return __jsx(ErrorMsg, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 55\n          }\n        }, msg);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 13\n      }\n    }), __jsx(Field, {\n      placeholder: \"password\",\n      className: \"primary\",\n      type: \"password\",\n      name: \"password\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 13\n      }\n    }), __jsx(ErrorMessage, {\n      name: \"password\",\n      render: function render(msg) {\n        return msg.split(',').map(function (m) {\n          return __jsx(ErrorMsg, {\n            key: m,\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 82\n            }\n          }, m);\n        });\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }\n    }), __jsx(Btn, {\n      name: \"submit\",\n      primary: true,\n      submit: true,\n      disabled: isSubmitting,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 13\n      }\n    }, signin && 'sign in' || signup && 'sign up'), __jsx(ErrorMessage, {\n      name: \"submit\",\n      render: function render(msg) {\n        return __jsx(ErrorMessage, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 56\n          }\n        }, msg);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }\n    }));\n  }));\n}\n\n_s(SignIn, \"yh3kefJHdufW/qU1Db0lxgeyNY0=\");\n\n_c2 = SignIn;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ErrorMsg\");\n$RefreshReg$(_c2, \"SignIn\");","map":{"version":3,"sources":["/Users/Doug/Library/Mobile Documents/com~apple~CloudDocs/Development/20200912-text-me-daily/text-me-daily/client/components/signIn.js"],"names":["Formik","Form","Field","ErrorMessage","Btn","axios","Cookies","useSWR","useState","Router","ErrorMsg","children","SignIn","signin","signup","setNeedSignUp","setCreatedUser","serverUrl","logInError","setLogInError","createUser","values","fetch","method","headers","body","JSON","stringify","err","console","error","logInAndSetCookies","cookies","post","then","res","set","data","token","refreshToken","status","email","password","errors","test","push","filter","m","findIndex","join","setSubmitting","setTimeout","ok","json","msg","isSubmitting","split","map"],"mappings":"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","sourcesContent":["import { Formik, Form, Field, ErrorMessage } from 'formik'\nimport Btn from './btn';\nimport axios from 'axios';\nimport { Cookies } from \"react-cookie\";\nimport useSWR from 'swr'\nimport { useState } from 'react'\nimport Router from 'next/router';\n\nexport function ErrorMsg({ children }) {\n  return <div className=\"errorMsg\">{children}</div>\n}\n\nexport default function SignIn({ signin, signup, setNeedSignUp, setCreatedUser, serverUrl }) {\n  const [logInError, setLogInError] = useState(false);\n\n  const createUser = (values) => {\n    try {\n      return fetch(serverUrl + '/api/createuser',\n        {\n          method: \"POST\",\n          headers: {\n            'Content-type': 'application/json',\n          },\n          body: JSON.stringify(values)\n        });\n    } catch (err) {\n      console.error(err);\n      setLogInError(true);\n    }\n  };\n\n  const logInAndSetCookies = (values) => {\n    // set up cookies\n    try {\n      const cookies = new Cookies();\n      axios.post(serverUrl + '/api/login', values)\n        .then(res => {\n          cookies.set('token', res.data.token);\n          cookies.set('refreshToken', res.data.refreshToken);\n          cookies.set('status', res.data.status);\n        });\n\n    } catch (err) {\n      console.error(err);\n      setLogInError(true);\n    }\n  }\n\n  return (\n    <>\n      <Formik\n        initialValues={{ email: 'doug@weomedia.com', password: 'P@ssw0rd' }}\n        validate={values => {\n          const errors = {};\n          if (!values.email) {\n            errors.email = 'email required';\n          } else if (!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i.test(values.email)) {\n            errors.email = 'Invalid email address';\n          }\n          if (!values.password) {\n            errors.password = 'password required'\n          } else if (signup && !/^(?=.*\\d)(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z])([a-z]|[A-Z]|[0-9]|[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~]){8,}$/.test(values.password)) {\n            errors.password = ['needs to add:'];\n            if (!/(?=.*\\d)/.test(values.password)) {\n              errors.password.push('numbers')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'numbers');\n            }\n            if (!/(?=.*[!\\\"#$%&'()*+,\\-.\\/:;<=>?@\\[\\\\\\]^_`{|}~])/.test(values.password)) {\n              if (errors.password.findIndex(m => m === 'special characters') === -1) {\n                errors.password.push('special characters');\n              }\n            } else {\n              errors.password = errors.password.filter(m => m !== 'special characters');\n            }\n            if (!/(?=.*[a-z])/.test(values.password)) {\n              errors.password.push('lowercase')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'lowercase');\n            }\n            if (!/(?=.*[A-Z])/.test(values.password)) {\n              errors.password.push('uppercase')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'uppercase');\n            }\n            if (!/.{8,}/.test(values.password)) {\n              errors.password.push('at least 8')\n            } else {\n              errors.password = errors.password.filter(m => m !== 'at least 8');\n            }\n            errors.password = errors.password.join(',')\n          }\n          return errors;\n        }}\n        onSubmit={async (values, { setSubmitting }) => {\n          setLogInError(false);\n          signin &&\n            setTimeout(async () => {\n              await logInAndSetCookies(values);\n              Router.push('/dashboard');\n              // alert(JSON.stringify(values, null, 2));\n            }, 400);\n          setSubmitting(false);\n          signup &&\n            setTimeout(() => {\n              createUser(values).then(res => {\n                if (res.ok) {\n                  // console.log(res)\n                  // console.log('created');\n                  // alert(JSON.stringify(values, null, 2));\n                  setCreatedUser(true);\n                  setNeedSignUp(false);\n                } else {\n                  res.json().then(res => console.error(res.msg));\n                  setLogInError(true);\n                }\n              }).catch(err => { if (err) console.error(err) });\n            }, 400);\n          setSubmitting(false);\n        }}\n      >\n        {({ isSubmitting }) => (\n          <Form>\n            {logInError && <ErrorMsg>email/password already exists or is wrong</ErrorMsg>}\n            <Field\n              placeholder=\"email\"\n              className=\"primary\"\n              type=\"email\"\n              name=\"email\"\n            />\n            <ErrorMessage name=\"email\" render={msg => <ErrorMsg>{msg}</ErrorMsg>} />\n            <Field\n              placeholder=\"password\"\n              className=\"primary\"\n              type=\"password\"\n              name=\"password\"\n            />\n            <ErrorMessage name=\"password\" render={msg => msg.split(',').map(m => <ErrorMsg key={m}>{m}</ErrorMsg>)} />\n            <Btn name=\"submit\" primary submit disabled={isSubmitting}>\n              {signin && 'sign in' || signup && 'sign up'}\n            </Btn>\n            <ErrorMessage name=\"submit\" render={msg => <ErrorMessage>{msg}</ErrorMessage>} />\n          </Form>\n        )}\n      </Formik>\n    </>\n  )\n}\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}